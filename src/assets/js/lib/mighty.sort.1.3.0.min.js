/*
	* Mighty sort - Styleship alignment tools of list of the different vertical length type. 
	* Version 1.3.0
	* Edit 26.April.2016 
	* www.styleship.com
	* By Woos / Multimedia team Director;
	*
	* 본 소스는 법으로 보호되는 Styleship의 지적재산으로서
	* 본 제작자와 회사의 허가를 받지 않은 사용자 혹은 사이트에서 무단 사용시  
	* 민형사상의 처벌 및 배상이 따르게 됩니다.
	* 
	ⓒ Styleship inc. All Right Reserved. 
	*
	*	v.1.3.0		changeOption(기본 옵션 변경에 매서) 기능 추가
	*	v.1.2.1		확실하지 않았던 정렬 순서에 대한 정리 완료. 코딩중의 이미지의 로딩 지연시 정렬 처리 해결
	*	v.1.2.0		refreshCoding 매서드 추가 : 정렬되는 리스트의 추가 혹은 삭제시 사용.
	*	v.1.1.2		dataXML 초기 설정시 미반영되는 현상 패치.
	*	v.1.1.1		xml data 추가시 '<content>'노드 한개당 '<li>'가 두개씩 생성되는 발생되는 버그 패치, 리사이즈시 스크롤이 최상단으로 올라가던 버그 패치
	*	v.1.1.0		가로 세로 방향의 마진값을 따로 적용하게 하기 위한 옵션 추가, 모순 옵션 방지 패치, 컨테이너 오브젝트 없이 설정될 경우 플러그인 무시 처리
	*	v.1.0.0		참을 수 없는 이전버전 플러그인 -티코타일의 잘못된 개발로 인한 맨땅에서 다시 만들어낸 플러그인
	
*/

function MightySort(a,b){return a.mightySort(b)}(function(a){a.fn.mightySort=function(f){var g=new Object();var r=this;g.content=this;var o=r.attr("id")?"#"+r.attr("id"):"."+r.attr("class").split(" ")[0];var n=a(this);if(n.size()==0){try{console.log("Does not exist Object of apply to mightySort.")}catch(s){}return}var l,p,v={},h={},b={},t=[],u=[];l={align:"center",autoResize:false,categoryList:["all"],dataXML:null,resizable:false,itemWidth:100,maxSortLine:null,minSortLine:1,margin:0,horizontalMargin:null,verticalMargin:null,orderList:["latest","oldest","view"],randomDelay:0,setCategory:"all",setOrder:"latest",speed:300};p=a.extend(l,f);fixOption=function(){p.align=p.align.toLowerCase();if(p.align!="center"&&p.align!="left"&&p.align!="right"&&p.align!="justify"){p.align="center"}if(m(p.categoryList)){p.categoryList=[p.categoryList]}if(p.maxSortLine==0){p.maxSortLine=null}if(p.margin<0){p.margin=0}if(p.horizontalMargin==null){p.horizontalMargin=p.margin}if(p.verticalMargin==null){p.verticalMargin=p.margin}if(m(p.orderList)){p.orderList=[p.orderList]}if(p.randomDelay<0){p.randomDelay=0}if(p.speed<0){p.speed=0}};fixOption();r.itemWidth;r.numItems=0;r.numCol=0;r.category=p.setCategory;r.order=p.setOrder;init=function(){c();if(p.dataXML){r.loadXML(p.dataXML,true)}r.sortCategory(p.setCategory);r.sortOrder(p.setOrder);v.enableResize=true;r.refresh(true);if(p.autoResize){h.resize()}};var b={data:null,step:null,wd:null,left:null,hg:0,build:function(){b.data=[];b.getWd();b.getMg();trace("optnMg:"+p.margin)},getWd:function(){b.wd=n.width();b.hg=0;b.step=p.itemWidth+p.horizontalMargin;if(p.resizable){r.numCol=Math.max(p.minSortLine,Math.round((b.wd+p.horizontalMargin)/b.step))}else{r.numCol=Math.max(p.minSortLine,Math.floor((b.wd+p.horizontalMargin)/b.step))}if(p.maxSortLine){r.numCol=Math.min(p.maxSortLine,r.numCol)}if(p.resizable){r.itemWidth=Math.round((b.wd-(r.numCol-1)*p.horizontalMargin)/r.numCol)}else{r.itemWidth=p.itemWidth}for(var e=0;e<r.numCol;e++){b.data[e]=0}},getMg:function(){b.left=[];if(p.resizable){b.resizableMg()}else{b.fixMg()}},resizableMg:function(){b.step=(b.wd+p.horizontalMargin)/r.numCol;for(var e=0;e<r.numCol;e++){b.left.push(Math.round(b.step*e))}},fixMg:function(){var w;if(p.align=="left"){for(var e=0;e<r.numCol;e++){b.left.push(Math.round(b.step*e))}}else{if(p.align=="right"){w=b.wd-r.numCol*b.step;for(var e=0;e<r.numCol;e++){b.left.push(Math.round(b.step*e)+w)}}else{if(p.align=="justify"){if(r.numCol>1){w=(b.wd-r.numCol*p.itemWidth)/(r.numCol-1);for(var e=0;e<r.numCol;e++){if(e==0){b.left.push(0)}else{b.left.push(Math.round((p.itemWidth+w)*e))}}}else{b.left[0]=(b.wd-r.numCol*p.itemWidth)/2}}else{w=(b.wd-r.numCol*b.step)/2;for(var e=0;e<r.numCol;e++){b.left.push(Math.round(b.step*e)+w)}}}}},pos:function(z){var x,w;for(var e=0;e<b.data.length;e++){if(e==0){x=b.data[e];w=0}else{if(b.data[e]<x){x=b.data[e];w=e}}}var y=b.data[w];b.data[w]+=z.dom.height()+p.verticalMargin;if(b.data[w]>b.hg){b.hg=b.data[w]}return{pos:w,topValue:y,leftValue:b.left[w]}}};h={watchTime:null,compareWd:0,resize:function(){h.watchTime=setInterval(h.resizeHandler,1000/24)},resizeHandler:function(){if(!n){clearInterval(h.watchTime);h.watchTime=null;return}if(!v.enableResize){return}if(h.compareWd==n.width()){return}h.compareWd=n.width();r.refresh(false)}};function c(){r.numItems=n.children("li").size();n.children("li").each(function(e){var w=a(this);var x={no:e,dom:w,category:w.attr("data-category")?w.attr("data-category").split(" "):[],html:w.html(),order:{},pos:{topValue:null,leftValue:null,opacity:null},view:true};for(var e=0;e<p.orderList.length;e++){x.order[p.orderList[e]]=w.attr("data-"+p.orderList[e])}if(p.autoResize){x.dom.find("img").each(function(){var y=a(this);j(y)})}t.push(x)})}r.loadXML=function(e,x){if(!e){return}if(!m(e)){return}if(e.length<=4){return}if(x!=true){n.html("");t=new Array()}var w={url:e,dataType:"xml",success:d,error:function(A,B,z){if(p.debug_mode){try{console.log("요청 정보를 가져올 수 없습니다!  ("+z+")")}catch(y){}}}};a.ajax(w)};function d(w){var e=a(w).find("content");r.trigger({type:"datacomplete",dataType:"xml",xml:w});e.each(function(z,y){var A=a(this);var B={category:A.attr("data-category")?A.attr("data-category").split(" "):[],html:A.text(),order:{},pos:{topValue:null,leftValue:null,opacity:null},view:true};n.append("<li>"+B.html+"</li>");var x=n.children("li:last");if(A.attr("id")){x.attr("id",A.attr("id"))}if(A.attr("class")){x.attr("class",A.attr("class"))}if(A.attr("style")){x.attr("style",A.attr("style"))}if(A.attr("data-category")){x.attr("data-category",A.attr("data-category"))}for(var z=0;z<p.orderList.length;z++){if(A.attr("data-"+p.orderList[z])){B.order[p.orderList[z]]=A.attr("data-"+p.orderList[z]);x.attr("data-"+p.orderList[z],A.attr("data-"+p.orderList[z]))}else{B.order[p.orderList[z]]=null}}B.dom=x;if(p.autoResize){B.dom.find("img").each(function(){var C=a(this);j(C)})}t.push(B);r.numItems=n.children("li").size();r.trigger({type:"added",dataType:"xml",no:z,itemHTML:B.html,xml:w,target:B.dom})});r.trigger({type:"addcomplete",dataType:"xml",xml:w});r.refresh(true)}r.sortCategory=function(e){if(!e){u=t;r.category="all";return}if(m(e)){if(e.toLowerCase().split("all").length>1){u=t;r.category="all";return}e=e.split(" ")}else{if(e.join("").toLowerCase().split("all").length>1){u=t;r.category="all";return}}u=[];var z;for(var x=0;x<t.length;x++){z=false;for(var y=0;y<e.length;y++){categories=t[x].category;for(var w=0;w<categories.length;w++){if(categories[w]==e[y]){z=true}}}if(z){u.push(t[x])}}r.sortOrder()};r.sortOrder=function(w){if(!w){w=r.order}if(w=="latest"){u=t}else{if(w=="oldest"){u=[];for(var e=0;e<t.length;e++){u[e]=t[(t.length-e-1)]}}else{r.order=w;u.sort(function(y,x){var A=y.order[w];var z=x.order[w];return(A<z)?-1:(A>z)?1:0})}}};r.refresh=function(e){v.enableResize=false;setTimeout(function(){v.enableResize=true},p.speed);b.build();n.children("li").each(function(w){a(this).css({width:r.itemWidth,position:"absolute"})});i(e);q(e);n.css("height",b.hg)};r.refreshCoding=function(){r.numItems=n.children("li").size();t=[];n.children("li").each(function(e){var x=a(this);var y={no:e,dom:x,category:x.attr("data-category")?x.attr("data-category").split(" "):[],html:x.html(),order:{},pos:{topValue:null,leftValue:null,opacity:null},view:true};for(var w=0;w<p.orderList.length;w++){y.order[p.orderList[w]]=x.attr("data-"+p.orderList[w])}if(p.autoResize){y.dom.find("img").each(function(){var z=a(this);j(z)})}t.push(y)});u=t;r.sortCategory(r.category);r.sortOrder(r.order);r.refresh(true)};r.changeOption=function(e){p=a.extend(p,e);if(p.margin||p.margin==0){if(!e.horizontalMargin&&e.horizontalMargin!=0){p.horizontalMargin=p.margin}if(!e.verticalMargin&&e.verticalMargin!=0){p.verticalMargin=p.margin}}fixOption();k()};function k(){}function i(w){if(p.speed<10){w=true}for(var e=0;e<t.length;e++){t[e].view=false}for(var e=0;e<u.length;e++){u[e].view=true}for(var e=0;e<t.length;e++){if(!t[e].view){if(!w){TweenMax.to(t[e].dom,p.speed/1000,{css:{opacity:0,display:"none"},overwrite:true,delay:Math.random()*p.speed/1000*0.5})}else{t[e].dom.css({opacity:0,display:"none"})}t[e].pos={pos:0,topValue:0,leftValue:0,opacity:0}}}}function q(w){if(p.speed<10){w=true}var y,x;for(var e=0;e<u.length;e++){y=b.pos(u[e]);y.opacity=1;x=u[e].dom;if(y.topValue!=u[e].pos.topValue||y.leftValue==u[e].pos.leftValue||u[e].pos.opacity==1){u[e].pos=y;if(!w){TweenMax.to(x,0.01,{css:{display:"block"},overwrite:true});TweenMax.to(x,p.speed*0.4/1000,{css:{opacity:1,left:y.leftValue,top:y.topValue,opacity:1},delay:Math.random()*p.speed/1000*0.6,ease:Quad.easeInOut})}else{x.css({opacity:1,display:"block",left:y.leftValue,top:y.topValue})}}}}function j(w){if(w.height()>0){return}if(w.attr("height")=="0"){return}var e=setInterval(function(){if(w.height()>0){clearInterval(e);r.refresh()}},1000/24)}function m(e){if(typeof(e)=="string"){return true}else{return false}}init();return r}})(jQuery);